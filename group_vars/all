# vim: ft=yaml:foldmethod=indent:foldenable
#
env:
  default: &env_defaults

    ssh_keys:
      - { hostgroup: 'jenkins_servers',
          owner: 'jenkins',
          path: '/var/lib/jenkins/.ssh/id_rsa',
          contents: [
            '-----BEGIN RSA PRIVATE KEY-----',
            'MIIEogIBAAKCAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzI',
            'w+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoP',
            'kcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2',
            'hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NO',
            'Td0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcW',
            'yLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQIBIwKCAQEA4iqWPJXtzZA68mKd',
            'ELs4jJsdyky+ewdZeNds5tjcnHU5zUYE25K+ffJED9qUWICcLZDc81TGWjHyAqD1',
            'Bw7XpgUwFgeUJwUlzQurAv+/ySnxiwuaGJfhFM1CaQHzfXphgVml+fZUvnJUTvzf',
            'TK2Lg6EdbUE9TarUlBf/xPfuEhMSlIE5keb/Zz3/LUlRg8yDqz5w+QWVJ4utnKnK',
            'iqwZN0mwpwU7YSyJhlT4YV1F3n4YjLswM5wJs2oqm0jssQu/BT0tyEXNDYBLEF4A',
            'sClaWuSJ2kjq7KhrrYXzagqhnSei9ODYFShJu8UWVec3Ihb5ZXlzO6vdNQ1J9Xsf',
            '4m+2ywKBgQD6qFxx/Rv9CNN96l/4rb14HKirC2o/orApiHmHDsURs5rUKDx0f9iP',
            'cXN7S1uePXuJRK/5hsubaOCx3Owd2u9gD6Oq0CsMkE4CUSiJcYrMANtx54cGH7Rk',
            'EjFZxK8xAv1ldELEyxrFqkbE4BKd8QOt414qjvTGyAK+OLD3M2QdCQKBgQDtx8pN',
            'CAxR7yhHbIWT1AH66+XWN8bXq7l3RO/ukeaci98JfkbkxURZhtxV/HHuvUhnPLdX',
            '3TwygPBYZFNo4pzVEhzWoTtnEtrFueKxyc3+LjZpuo+mBlQ6ORtfgkr9gBVphXZG',
            'YEzkCD3lVdl8L4cw9BVpKrJCs1c5taGjDgdInQKBgHm/fVvv96bJxc9x1tffXAcj',
            '3OVdUN0UgXNCSaf/3A/phbeBQe9xS+3mpc4r6qvx+iy69mNBeNZ0xOitIjpjBo2+',
            'dBEjSBwLk5q5tJqHmy/jKMJL4n9ROlx93XS+njxgibTvU6Fp9w+NOFD/HvxB3Tcz',
            '6+jJF85D5BNAG3DBMKBjAoGBAOAxZvgsKN+JuENXsST7F89Tck2iTcQIT8g5rwWC',
            'P9Vt74yboe2kDT531w8+egz7nAmRBKNM751U/95P9t88EDacDI/Z2OwnuFQHCPDF',
            'llYOUI+SpLJ6/vURRbHSnnn8a/XG+nzedGH5JGqEJNQsz+xT2axM0/W/CRknmGaJ',
            'kda/AoGANWrLCz708y7VYgAtW2Uf1DPOIYMdvo6fxIB5i9ZfISgcJ/bbCUkFrhoH',
            '+vq/5CIWxCPp0f85R4qxxQ5ihxJ0YDQT9Jpx4TMss4PSavPaBH3RXow5Ohe+bYoQ',
            'NE5OgEXk2wVfZczCZpigBKbKZHNYcelXtTt/nP3rsCuGcM4h53s=',
            '-----END RSA PRIVATE KEY-----'
          ]
        }

      - { hostgroup: 'jenkins_servers',
          owner: 'jenkins',
          path: '/var/lib/jenkins/.ssh/id_rsa.pub',
          contents: [
            'ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key'
          ]
        }

    authorized_keys:
      - { hostgroup: 'zabbix_servers',
          owner: 'root',
          path: '/root/.ssh/authorized_keys',
          contents: "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key"
        }

    # jenkins configuration settings
    jenkins:
      version: 1.568-1.1
      dest: /opt/jenkins
      lib: /var/lib/jenkins
      port: 8080
      prefix: /jenkins
      cli_dest: '/opt/jenkins/jenkins-cli.jar' # Jenkins CLI destination
      updates_dest: '/opt/jenkins/updates_jenkins.json' # Jenkins updates file

      # list of jenkins plugins to be installed on the jenkins box
      plugins:
        - build-pipeline-plugin
        - job-dsl
        - git
        - parameterized-trigger
        - ansicolor
        - build-flow-plugin
        - build-timeout
        - build-with-parameters
        - buildgraph-view
        - config-autorefresh-plugin
        - configurationslicing
        - copyartifact
        - credentials
        - delivery-pipeline-plugin
        - envinject
        - external-monitor-job
        - flexible-publish
        - git-client
        - github-api
        - github-oauth
        - github
        - gitlab-hook
        - greenballs
        - job-log-logger-plugin
        - jobConfigHistory
        - log-parser
        - mailer
        - mask-passwords
        - multiple-scms
        - naginator
        - parameterized-trigger
        - publish-over-ssh
        - rebuild
        - show-build-parameters
        - ssh-agent
        - ssh-credentials
        - ci-game
        - throttle-concurrents
        - timestamper

      jobs:

        jinja2_base_template:
          options: &base_template_options { disabled: false,
                                            concurrentbuild: false }

          buildWrappers: &base_template_wrappers
            - &BuildTimeOutWrapper_defaults { type: 'BuildTimeoutWrapper',
                                             timeoutMinutes: 60,
                                             strategy: 'AbsoluteTimeOutStrategy',
                                             failBuild: true,
                                             writingDescription: false }

            - &TimeStamper_defaults { type: 'Timestamper',
                                     options: none }

            - &AnsiColor_defaults { type: 'AnsiColor',
                                   colorMapName: xterm }

        jinja2_run_ansible:
          description: "Executes Ansible"
          options: { disabled: false,
                     blocks: [ 'downstream', 'upstream' ],
                     concurrentbuild: true }
          parameters:
            - { name: 'INVENTORY_FILE',
                type: 'choice',
                description: 'Which Inventory File to use',
                choices: { type_string: ['vagrant', 'dev', 'qa', 'prd']}}

            - { name: 'PLAYBOOK',
                type: 'choice',
                description: 'Which playbook to execute',
                choices: { type_string: ['jenkins.yml', 'zabbix.yml', 'site.yml']}}

            - { name: "LIMIT",
                type: 'string',
                description: "Ansible --limit",
                default: "all" }

            - { name: "TAGS",
                type: 'string',
                description: "Ansible --tags",
                default: "" }

            - { name: "START_AT_TASK",
                type: 'string',
                description: "Ansible --start-at-task",
                default: "" }

            - { name: "RELEASE",
                type: 'string',
                description: "RELEASE number to use",
                default: "latest" }

            - { name: "VAULT",
                type: 'password',
                description: "Ansible Vault Password",
                default: "" }

          scm:
            - { type: 'git',
                url: 'https://github.com/Azulinho/ansible-jenkins-showcase.git',
                branches: ['*/master'] }


          builders:
            - { type: 'shell',
                command_lines: [
                  "#!/bin/bash",
                  "export PATH=/usr/local/bin:$PATH",
                  "export PYTHONUNBUFFERED=1",
                  "echo $VAULT &gt; .vault",
                  "ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook -u vagrant -s -i $INVENTORY_FILE -l $LIMIT $PLAYBOOK --vault-password-file .vault" ]}

          buildWrappers: *base_template_wrappers

        jinja2_deploy_template:
          options: &deploy_template_options { disabled: false,
                                              blocks: [ 'downstream',
                                                        'upstream' ],
                                              concurrentbuild: true }
          builders:
            - { type: 'shell',
                command_lines: [
                  "#!/bin/bash",
                  "echo $VAULT &gt; .vault",
                  "ansible-playbook -s -i $INVENTORY_FILE -l $LIMIT $PLAYBOOK --vault-password-file .vault" ]}

        jinja2_deploy_job1:
          options: *deploy_template_options
          parameters:
            - { name: "PARAMETER1",
                type: 'string',
                description: "PARAMETER 1",
                default: "all" }
          builders:
            - { type: 'shell',
                command_lines: [
                  "#!/bin/bash",
                  "echo deploy_job1" ]}
          buildWrappers: *base_template_wrappers
          publishers:
            - { type: 'parametrizedTrigger', projects: ['deploy_job2'], condition: 'success', parameters: ['VAR1=var1', 'VAR2=var2'], triggerWithNoParameters: false }

        jinja2_deploy_job2:
          options: *deploy_template_options
          builders:
            - { type: 'shell',
                command_lines: [
                  "#!/bin/bash",
                  "echo deploy_job2" ]}
          buildWrappers: [ *BuildTimeOutWrapper_defaults, *TimeStamper_defaults, *AnsiColor_defaults ]
          publishers:
            - { type: 'parametrizedTrigger', projects: ['deploy_job3'], condition: 'success', parameters: ['VAR1=var1', 'VAR2=var2'], triggerWithNoParameters: false }

        jinja2_deploy_job3: { options: *deploy_template_options, builders: [ { type: 'shell', command_lines: [ "#!/bin/bash", "echo deploy_job3" ]} ], buildWrappers: *base_template_wrappers , publishers: [ {type: 'parametrizedTrigger', projects: ['deploy_job4']} ] }
        jinja2_deploy_job4: { options: *deploy_template_options, builders: [ { type: 'shell', command_lines: [ "#!/bin/bash", "echo deploy_job4" ]} ], buildWrappers: *base_template_wrappers , publishers: [ {type: 'parametrizedTrigger', projects: ['deploy_job5']} ]}
        jinja2_deploy_job5: { options: *deploy_template_options, builders: [ { type: 'shell', command_lines: [ "#!/bin/bash", "echo deploy_job5" ]} ], buildWrappers: *base_template_wrappers , publishers: [ {type: 'parametrizedTrigger', projects: ['deploy_job6']} ]}
        jinja2_deploy_job6: { options: *deploy_template_options, builders: [ { type: 'shell', command_lines: [ "#!/bin/bash", "echo deploy_job6" ]} ], buildWrappers: *base_template_wrappers }

      # here we set the first jobs in the pipeline,
      # this will be used by the kick-pipeline role
      #
      pipeline_first_jobs:
        - DSL_DEPLOY-job1
        - jinja2_deploy_job1

  vagrant: *env_defaults
  dev: *env_defaults
  qa: *env_defaults
  prd: *env_defaults

# zabbix settings
zabbix_client_port : "10050"
zabbix_nodeid : 99
zabbix_server: zabbix
zabbix_server_port : "10051"

zabbix_username : admin
zabbix_password : password
zabbix_mysql_username: zabbix
zabbix_mysql_password: password

